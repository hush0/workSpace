微信公众、开放、商户平台开发


1 简介
1.1 微信公众平台
       1.1.1  微信公众平台是什么
                         微信公众平台，是处理公众号、服务号，订阅号相关的业务，为微信用户提供资讯和服务的平台。 一个比较重要的特点是用户操作都在微信内部。

                         微信公众号申请成功后，会分配一个appid，用来标识这个公众号。用openid 来区分公众号下不同用户，可以简单的理解为 openid=hash(uid+appid)。

       1.1.2  微信公众号能干什么
                        （1）微信公众号作为用户的一个联系人，具备和用户互发消息的功能。 （1）群发消息  （2）被动回复消息 （3）客服消息 （4）模版消息

                        （2）公众号用内部的网页提供服务。（1）获取用户信息，用于授权登陆，支付等业务功能。 （2）通过调用微信JS-SDK 使用微信原生功能。

1.2  微信开放平台
        1.2.1  微信开放平台是什么
                         微信开放平台接入移动应用、PC端网站、公众号第三方平台（为各行各业公众号运营者提供服务）。开放平台接入移动应用后，也会给应用分配一个

                         appid 来作为应用的标识，同样的在这个应用(appid) 下也有一套识别用户的openid 机制。

       1.2.2   微信开放平台能干什么
                          如果需要在多公众号、移动应用之间做用户共通，则需前往微信开放平台，将这些公众号和应用绑定到一个开放平台账号下，绑定后，一个用户虽然对

                          多个公众号和应用有多个不同的OpenID，但他对所有这些同一开放平台账号下的公众号和应用，只有一个UnionID

1.3 微信商户平台
      1.3.1 商户号的作用
                          微信商户平台用于管理收付款账户。商户号开通后微信会分配一个 merchantId(简称mchID) ，用于标识一个收款的账号。

      1.3.2  商户号的开通方式
                        (1)  在微信的开放平台或者公众号平台注册账号后，开通该app或公众号的收款权限，此时微信会自动分配一个商户号。这种情况下

                              appid就是注册时微信的开放平台或者公众号平台中可以查看。

                      （2）财务人员找微信单独开通商户号，这种情况下没有appid，此时需要申请appid或者使用已有的appid进行绑定后方能正常收款

       1.3.3  商户号和appid之间的关系
                         (1)一个appid可以绑定多个商户号，意思是一个滴滴的app中，不同的业务线可以收到不同的商户号中，比如出租车、顺风车收款

                              分别收到对应的商户号（公司主体不一样）。

                         (2)一个商户号可以绑定多个appid，意思是一个企业充值的商户，即可以在滴滴的主app中收款，也可以在滴滴企业打车app中收款

       1.3.4 微信收付款参数的理解
                          在微信支付的技术体系里，为了安全或者其他原因，进行交易时接口的参数中只有商户号是不够的，必须有appid（包括支付、查询、退款等）。

                          appid可用于标识支付完成后返回到对应的app。mchID 表示收付款的账户，appid 表示业务线，openid 表示付款的人。

微信支付时，需要appid和商户号进行绑定，
当二者申请时的公司主体一致，则绑定流程比较简单，不需要填写申请信息（小程序：直接在小程序后台配置后，在商户号的后台进行确认即可；公众号或者app：向微信提申请绑定）。
当二者申请时的公司主体不一致，则绑定的流程比较复杂，需要签署联合运营函，邮寄到微信公司，然后微信才能在他们的后台给于绑定。




2  接口功能介绍
2.1  微信公众平台常用接口
        （获取授权码，授权码换access token，刷新access token，访问其它接口）









3  日常维护


      3.1  公众号小程序添加授权域名流程

                 公众号小程序常见设置及注意事项









4  常见问题
  4.1  为什么要把获取openid  用户信息接口交给公共平台开发，而不是各方直接对接微信平台接口 ？
      减少对公众号的配置，有很多接入方时能加快对接速度。

      accesstoken  每天有调用次数限制，2 小时过期，过期后需要调刷新接口。多个使用方单独调用，互相刷新很容易达到调用频次上限

      第三方需要一个access_token获取和刷新的中控服务器。并发获取access_token会导致AccessToken互相覆盖，影响具体的业务功能。

      https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1472017492_58YV5      4.2.2章节有说明。

      T1 ： 接入方 A 持有有效的 accesstoken1,接入方B 持有有效的 accesstoken1

      T2 :    接入方A 调用接口提示，accesstoken 过期，调用刷新接口获得有效 accesstoken2，调用接口执行业务操作

      T3:     接入方B 调用接口提示，accesstoken 过期，调用刷新接口获得有效 accesstoken3，调用接口执行业务操作

      T4:     重复以上过程。。。。。。





5 参考资料
https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1445241432

公众号小程序常见设置及注意事项

微信的appid与商户号绑定

